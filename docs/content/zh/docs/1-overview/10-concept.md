---
title: 核心概念
slug: concept
weight: 10
description: >
  了解了核心概念之后，很容易上手使用。
---

## 页面和站点 [ Page and Site ]

我们抓取的目标一般是一个站点`Site`的若干页面`Page`。一个页面会对应一个`URL`，`URL`通常指向一个`HTML`文档，
`HTML`中还会引用若干静态资源。静态资源中的`js`脚本会被执行，并可能会对最终展示的`HTML`文档作出修改。

蜂雾系统的`Worker`有多种不同的类型，浏览器型模拟一个浏览器载入完整载入页面，可以抓取执行`js`脚本后的页面内容。
而精简型的`Worker`则只会请求`URL`指向的文档本身。

一个站点`Site`中的多个页面`Page`通常是依靠跳转链接`Link`联系起来的。


## 任务 [ Job ]

任务`Job`是蜂雾系统最主要的概念，一个任务包含抓取一个页面`Page`的一系列配置，由控制核心`QuennBee`分发给合适的边缘节点`Worker`执行。

由于有的页面可能会需要在不同时间反复抓取，也有一些页面，虽然`URL`不同，但它们有着相同的板式。
所以我们将一个任务`Job`拆解成任务模版`Template`和调用它的参数构成。这样边缘节点就可以缓存任务模版，节约网络传输的流量。

在模版之外，任务将包含三部分主要内容。

### 变量
模版中会包含有若干变量，有的在`URL`中，有的在`Request Body`中。
比如 `https://news.ycombinator.com/news?p={{page}}` 中的页码就是一个变量。

### 额外的 Query Params 和 Headers
一个 `Job` 可以携带额外的 Query Params 和 Request Headers ，如果模版中已经存在相同的 key，则 Job 中携带的有更高优先级。

### 上下文 Context
上下文会携带任务发起方的一些信息。后面我们会知道，任务也可以生成新的任务，所以 Context 有可能在任务中链式传递。


## 任务模版 [ Job Template ]

任务模版是本系统中最重要的概念，它描述了一个任务的整个生命周期。一个模版主要包含如下几个方面。

### 元数据
记录模版所属组织，创建时间等等各种管理信息，其中最重要的是模版版本。
模版在云端和边缘节点都会被缓存一段时间，任务中会指明模版的版本，如果版本一致将直接使用缓存。

### 请求模版
主要存储一个 HTTP 请求的各种固定的信息，其中包含若干变量供生成任务时填充。

### 响应处理工作流
在边缘节点确定页面加载完毕后，会顺次执行响应处理工作流。其中典型的部分是使用 xpath 或 css selector 抽取指定数据，
组建成结构化数据。工作流中还可能包含页面点击等操作，用以抓取单页应用中的数据。

### Worker Hooks
在边缘节点执行完响应处理工作流后，还可以增加更多额外的操作，比如生成新任务或就近上传某些静态数据等等。

### Cloud Hooks
在任务结果返回云端后，云端也可以选择执行一些特定的操作。


## 任务结果 [ Job Result ]

任务结果是任务在边缘节点执行后生成的一个结果对象，它会被返回云端等待后续处理。
